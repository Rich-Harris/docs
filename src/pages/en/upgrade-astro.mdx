---
layout: ~/layouts/MainLayout.astro
title: Upgrade Guide
description: How to upgrade your project to the latest version of Astro.
i18nReady: false
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'


This guide will help you migrate from Astro v1 to Astro v2.

Need to upgrade an older project to v1? See our [older migration guide](https://github.com/withastro/docs/blob/aa7e4f568f418657eba297778729a8aee2a36409/src/pages/en/migrate.mdx).

You can update your project's version of Astro to the latest version using your package manager. If you're using Astro integrations, please also update those to the latest version.
<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # updates the astro dependency:
  npm upgrade astro
  # or, to update all dependencies:
  npm upgrade
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # updates the astro dependency:
  pnpm upgrade astro
  # or, to update all dependencies:
  pnpm upgrade
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # updates the astro dependency:
  yarn upgrade astro
  # or, to update all dependencies:
  yarn upgrade
  ```
  </Fragment>
</PackageManagerTabs>

This guide includes major highlights and instructions on how to handle breaking changes when upgrading from v1.x and v2.0-beta releases. See [the changelog](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) for full release notes.


## Astro 2.0 Updates

### Updated: Node Version >=16.12.0

The minimum supported version of NodeJS is now 16.12.0.


### Updated: Vite 4

Astro v2.0 has upgraded from Vite 3 to [Vite 4](https://vitejs.dev/). We've handled most of the upgrade for you inside of Astro; however, some subtle Vite behaviors may still change between versions. 

Refer to the official [Vite Migration Guide](https://vitejs.dev/guide/migration.html) if you run into trouble.


## Astro 2.0 Breaking Changes

### Removed: `legacy.astroFlavoredMarkdown`

In 1.0 Astro moved the old Astro Flavored Markdown (also known as Components in Markdown) to a legacy feature. This change removes the `legacy.astroFlavoredMarkdown` option completely.

In 2.0 this feature is not available in Astro at all. We recommend [migrating to MDX with the integration](/en/guides/integrations-guide/mdx/) for those were still using this feature in 1.x. See our older migration guide for more about [converting existing Mardown files to MDX](https://github.com/withastro/docs/blob/aa7e4f568f418657eba297778729a8aee2a36409/src/pages/en/migrate.mdx#converting-existing-md-files-to-mdx).

### Removed: `Astro.resolve()`

In 0.24 Astro deprecated `Astro.resolve()`. This change removes the option completely.

In 2.0 this feature is not available in Astro at all. You can resolve asset paths using `import` instead. For example:

```astro
---
import 'style.css';
import imageUrl from './image.png';
---

<img src={imageUrl} />
```

See the [v0.24 migration guide](https://github.com/withastro/docs/blob/aa7e4f568f418657eba297778729a8aee2a36409/src/pages/en/migrate.mdx#deprecated-astroresolve) for more information.

### Removed: `Astro.fetchContent()`

In 0.26 Astro deprecated `Astro.fetchContent()`. This change removes the option entirely.

In 2.0 this feature is not available in Astro at all. Use [`Astro.glob()`](/en/guides/imports/#astroglob) instead to fetch Markdown files, or migrate to the [Content Collections](/en/guides/content-collections/) feature.

```js
let allPosts = await Astro.glob('./posts/*.md');
```

### Removed: `Astro.canonicalURL`

In 1.0 Astro deprecated `Astro.canonicalURL`. This change removes the option entirely.

In 2.0 this feature is not available in Astro at all. Use `Astro.url` instead to construct the canonical URL.

```js
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
```

### Added: `_astro/` folder for build assets

Astro 2.0 moves the location of all build output assets to a new `_astro/` folder. Previously, these assets were built to various locations, including `assets/`, `chunks/` and the root of the build output. 

You can control this location with the [new `build.assets` configuration option](/en/reference/configuration-reference/#buildassets).

If your deployment relies on the location of these assets, you may need to update your caching configuration with your deployment platform.

### Changed: Markdown plugin configuration

#### Removed: `extendDefaultPlugins`

Astro 2.0 removes `markdown.extendDefaultPlugins`. Applying remark and rehype plugins **no longer disables** Astro's default plugins, so this option is no longer needed. 

GitHub-Flavored Markdown and Smartypants are now applied whether or not custom `remarkPlugins` or `rehypePlugins` are configured. (You can opt-out manually by setting [`gfm` and `smartypants`](#added-gfm-and-smartypants) to `false` in your config.)

You no longer need `extendDefaultPlugins: true` in your configuation. This is now Astro's default behavior in 2.0.

```diff
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  markdown: {
-   extendDefaultPlugins: true,
  }
});
```

#### Added: `gfm` and `smartypants`

Astro 2.0 replaces `markdown.extendDefaultPlugins` with separate Boolean options to control each of Astro's built-in default plugins individually. These are enabled by default, and can be set to `false` to remove the plugin.

- `markdown.gfm: false` disables GitHub-Flavored Markdown
- `markdown.smartypants: false` disables SmartyPants

```diff
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  markdown: {
-   extendDefaultPlugins: false,
+   smartypants: false,
+   gfm: false,
  }
});
```

### Changed: MDX plugin configuration

#### Removed: `extendPlugins`

Astro 2.0 removes the `mdx.extendPlugins` option to manage plugin defaults in MDX. This has been replaced by 3 flags:

- `mdx.extendMarkdownConfig` (`true` by default) to toggle Markdown config inheritance. This replaces the `extendPlugins: 'markdown'` option.
- `mdx.gfm` (`true` by default) to toggle GitHub-Flavored Markdown in MDX. This replaces the `extendPlugins: 'defaults'` option.
- `mdx.smartypants` (`true` by default) to toggle SmartyPants in MDX. This replaces the `extendPlugins: 'defaults'` option.

#### Added: `extendMarkdownConfig`

Astro 2.0 adds the Boolean [`mdx.extendMarkdownConfig`](/en/guides/integrations-guide/mdx/#extendmarkdownconfig) option to configure whether or not MDX should inherit your Markdown configuration. This option is `true` by default, and MDX options will default to their equivalent in your Markdown config. You no longer need `extendPlugins: 'markdown'` in your configuration for this behavior.

```diff
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  mdx: {
-   extendPlugins: markdown,
  }
});
```

Replace `extendPlugins: defaults` with `extendMarkdownConfig: false` and use the individual options to enable GitHub-Flavored Markdown and SmartyPants if you want to inherit only Astro's default plugins, and not any other Markdown configuration options.

```diff
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  mdx: {
-   extendPlugins: defaults,
+   extendMarkdownConfig: false,
+   smartypants: true,
+   gfm: true,
  }
});
```

#### Added: More MDX config options to match Markdown

Setting `extendMarkdownConfig` to false now allows you to individually set [every available Markdown configuration option](/en/reference/configuration-reference/#markdown-options) (except `drafts`) separately in your MDX integration config, including `syntaxHighlight`, `shikiConfig` and more.

```astro
// astro.config.mjs
import { defineConfig } from 'astro/config';
import mdx from '@astrojs/mdx';

export default defineConfig({
  markdown: {
    syntaxHighlight: 'prism',
    remarkPlugins: [remarkPlugin1],
    gfm: true,
  },
  integrations: [
    mdx({
      // `syntaxHighlight` inherited from Markdown

      // Markdown `remarkPlugins` ignored,
      // only `remarkPlugin2` applied.
      remarkPlugins: [remarkPlugin2],
      // `gfm` overridden to `false`
      gfm: false,
    })
  ]
});
```

### Added: Plugin access to frontmatter

Astro 2.0 gives remark and rehype plugins access to user frontmatter via frontmatter injection. This means `data.astro.frontmatter` is now the _complete_ Markdown or MDX document's frontmatter, rather than an empty object.

This allows plugin authors to modify existing frontmatter, or compute new properties based on other properties. For example, to compute a full image URL based on an `imageSrc` slug in your document frontmatter:

  ```ts
  export function remarkInjectSocialImagePlugin() {
    return function (tree, file) {
      const { frontmatter } = file.data.astro;
      frontmatter.socialImageSrc = new URL(frontmatter.imageSrc, 'https://my-blog.com/').pathname;
    };
  }
  ```

### Added: `src/content/`

Write stuff: if you have an existing `src/content/` folder, it will now conflict with content collections.

## Astro 2.0 Experimental Flags Removed

Remove the following experimental flags from `astro.config.mjs`:

```diff
import { defineConfig } from 'astro/config';

export default defineConfig({
- experimental: { contentCollections: true },
- experimental: { prerender: true },
- experimental: { error-overlay: true },
})
```
In Astro v2.0, these features are no longer hidden behind an experimental flag and are all enabled by default.

### Content Collections

The experimental flag `--experimental-contentCollections` has been removed. The Colletions API is now available by default in Astro. 

See more about using [content collections in Astro](/en/guides/content-collections/).

TODO - Guide for converting to Content Collections, ideally!

### Prerendering

The experimental flag `--experimental-prerender` has been removed. The `prerender` feature is now enabled by default when using [`output:'server'`](/en/reference/configuration-reference/#output). 

To prerender a particular page, add `export const prerender = true` to your frontmatter.

### Error overlay

The experimental flag `--experimental-error-overlay` has been removed. The error overlay during `astro dev` has a refreshed visual design and provides more context for your errors.


## Known Issues


