---
layout: ~/layouts/MainLayout.astro
title: Upgrade Guide
description: How to upgrade your project to the latest version of Astro.
i18nReady: false
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import FileTree from '~/components/FileTree.astro'


This guide will help you migrate from Astro v1 to Astro v2.

Need to upgrade an older project to v1? See our [older migration guide](https://github.com/withastro/docs/blob/aa7e4f568f418657eba297778729a8aee2a36409/src/pages/en/migrate.mdx).

## Upgrade Astro

1. You can check your version of Astro, and any official Astro integrations (`@astrojs/*`), in `package.json` at the root of your project. These may be in `devDependencies` and/or `dependencies`:

    ```json "@astrojs/" {7}
    //package.json
    "devDependencies": {
      "@astrojs/react": "^1.2.2",
      "@astrojs/svelte": "^1.0.2",
      "@astropub/icons": "^0.1.1",
      "accessible-astro-components": "^1.4.5",
      "astro": "1.9.2",
      "react": "^18.2.0",
      "react-dom": "^18.0.0",
      "svelte": "^3.47.0"
    },
    "dependencies": {
      "@astrojs/image": "0.13.0-beta.0",
      "@astrojs/rss": "^2.0.0",
      "@astrojs/vue": "^1.2.1",
      "vue": "^3.2.41"
    }
    ```

2. Update your project's version of Astro to the latest version using your package manager. If you're using Astro integrations, please also update those to the latest version.

    <PackageManagerTabs>
      <Fragment slot="npm">
      ```shell
      # upgrades to Astro v2.x:
      npm i astro@latest
      # to update all dependencies:
      npm upgrade
      ```
      </Fragment>
      <Fragment slot="pnpm">
      ```shell
      # upgrades to Astro v2.x:
      pnpm i astro@latest
      # to update all dependencies:
      pnpm upgrade
      ```
      </Fragment>
      <Fragment slot="yarn">
      ```shell
      # upgrades to Astro v2.x:
      yarn add astro@latest
      # to update all dependencies:
      yarn upgrade
      ```
      </Fragment>
    </PackageManagerTabs>

3. Check that you are running **at least Node `16.12.0`**. In v2.0, Astro dropped support for Node `14`.

    ```sh
    node -v
    ```
    
    If necessary, [update your version of Node](en/upgrade-astro/#removed-support-for-node-14) in your local and deployment environments.

## Do I need to update my code?

Many projects will not need any changes to the codebase! Your upgrade may now be complete. But, this upgrade does bring some big, potentially breaking changes:

- **Vite 4**

  Astro *should* [handle everything](#updated-vite-4) for you under the hood! But still, there's stuff to know!

- **the complete removal of several previously-deprecated items**

  Still using one of the [deprecated options mentioned below](#astro-20-breaking-changes)? That's got to go!

- **a new, unified location for your built assets**

  Have a [deploy config that depends on chunks](#added-_astro-folder-for-build-assets)? See below!

- **a redesign of Markdown and MDX plugin configuration**

  Using plugins in [Markdown](#changed-markdown-plugin-configuration) and [MDX](#changed-mdx-plugin-configuration)? Convert your config!

- **a new, reserved folder `src/content/` for the new Collections API**

  If you [have your own folder called `src/content/`](#added-srccontent), we'd like a word with you!

- **three exciting features that are no longer experimental**

  You [don't need these flags](#astro-20-experimental-flags-removed) to get the goodies. Open to everyone now!

You might have some work to do, and [you might see Houston](#error-overlay) a few times before you're done! 

If your project doesn't work as expected after upgrading to v2.0, then check this guide for major highlights and instructions on how to handle breaking changes when upgrading from v1.x and v2.0-beta releases. 

See [the changelog](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) for full release notes.


## Astro 2.0 Breaking Changes

### Updated: Vite 4

Astro v2.0 upgrades from Vite 3 to [Vite 4](https://vitejs.dev/). 

#### What should I do?

There should be no changes to your code necessary! Enjoy [many internal improvements under the hood](https://vitejs.dev/blog/announcing-vite4.html), without changing a thing.

We've handled most of the upgrade for you inside of Astro; however, some subtle Vite behaviors may still change between versions. 

Refer to the official [Vite Migration Guide](https://vitejs.dev/guide/migration.html) if you run into trouble.

### Removed: Support for Node 14

The minimum supported version of Node.js is now `16.12.0`.

#### What should I do?

Both your development environment and your deployment environment must now meet this minimum standard.

1. Check your local version of node using:

    ```sh
    node -v
 
    ```
    If your local development environment needs upgrading to Node 16, [install Node.js](https://nodejs.org/en/download/).


2. Check your [deployment environment's](/en/guides/deploy/) own documentation to verify that they support Node 16. 

    You can specify Node 16.12.0 for your Astro project either in a dashboard configuration setting, or a `.nvmrc` file.


### Removed: `legacy.astroFlavoredMarkdown`

In 1.0, Astro moved the old Astro Flavored Markdown (also known as Components in Markdown) to a legacy feature. 

Astro 2.0 removes the `legacy.astroFlavoredMarkdown` option completely. Importing and using components in `.md` files will no longer work.

#### What should I do?

This legacy flag is no longer available in Astro and should be removed:

```js del={3-5}
// astro.config.mjs
export default defineConfig({
	legacy: {
		astroFlavoredMarkdown: true,
	},
})

```

If you were using this feature in 1.x, we recommend [using the MDX integration](/en/guides/integrations-guide/mdx/) which allows you to include components and JSX expressions in your Markdown.

See our older upgrade guide for more about [converting existing Markdown files to MDX](https://github.com/withastro/docs/blob/aa7e4f568f418657eba297778729a8aee2a36409/src/pages/en/migrate.mdx#converting-existing-md-files-to-mdx).

### Removed: `Astro.resolve()`

In 0.24, Astro deprecated `Astro.resolve()` for getting resolved URLs to assets that you might want to reference in the browser.

Astro 2.0 removes this option entirely. `Astro.resolve()` in your code will cause an error.

#### What should I do?

Resolve asset paths using `import` instead. For example:

```astro
// src/pages/index.astro
---
import 'style.css';
import imageUrl from './image.png';
---

<img src={imageUrl} />
```

See the [v0.24 upgrade guide](https://github.com/withastro/docs/blob/aa7e4f568f418657eba297778729a8aee2a36409/src/pages/en/migrate.mdx#deprecated-astroresolve) for more information.

### Removed: `Astro.fetchContent()`

In 0.26, Astro deprecated `Astro.fetchContent()`for fetching data from your local Markdown files.

Astro 2.0 removes this option entirely. `Astro.fetchContent()` in your code will cause an error.

#### What should I do?

Use [`Astro.glob()`](/en/guides/imports/#astroglob) to fetch Markdown files, or convert to the [Content Collections](/en/guides/content-collections/) feature.

```astro
// src/pages/index.astro
---
let allPosts = await Astro.glob('./posts/*.md');
---
```

### Removed: `Astro.canonicalURL`

In 1.0, Astro deprecated `Astro.canonicalURL` for constructing a canonical URL. 


Astro 2.0 removes this option entirely. `Astro.canonicalURL()` in your code will cause an error.

#### What should I do?

Use `Astro.url` to construct a canonical URL.

```astro
// src/pages/index.astro
---
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

```

### Added: `_astro/` folder for build assets

In 1.0, assets were built to various locations, including `assets/`, `chunks/` and the root of the build output.

Astro 2.0 moves and unifies the location of all build output assets to a new `_astro/` folder. 

<FileTree>
- dist/
  - _astro
    - client.9218e799.js
    - index.df3f880e0.css
</FileTree>

You can control this location with the [new `build.assets` configuration option](/en/reference/configuration-reference/#buildassets).

#### What should I do?

If your deployment relies on the location of these assets, you may need to update your configuration with your deployment platform.


### Changed: Markdown plugin configuration

#### Removed: `extendDefaultPlugins`

Astro 2.0 removes `markdown.extendDefaultPlugins` for controlling Astro's default plugin behavior when adding your own plugins. 

Applying remark and rehype plugins in your Markdown configuration  **no longer disables Astro's default plugins**, so this option is no longer needed.

GitHub-Flavored Markdown and Smartypants are now applied whether or not custom `remarkPlugins` or `rehypePlugins` are configured. (You can opt out manually by setting the [new `gfm` and `smartypants` options](#added-gfm-and-smartypants) to `false` in your config.)


##### What should I do?

You no longer need `extendDefaultPlugins: true` in your configuration. This is now Astro's default behavior in 2.0, and you can delete this line without any replacement.

```js del={6}
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  markdown: {
    extendDefaultPlugins: true,
  }
});
```

#### Added: `gfm` and `smartypants`

Astro 2.0 replaces `markdown.extendDefaultPlugins` with separate Boolean options to control each of Astro's built-in default Markdown plugins individually. These are enabled by default, and can be set to `false` to remove each plugin independently.

##### What should I do?

The option `extendDefaultPlugins: false` no longer exists. To disable Astro's default plugins, disable each plugin individually instead.

- `markdown.gfm: false` disables GitHub-Flavored Markdown
- `markdown.smartypants: false` disables SmartyPants

```js del={6} ins={7-8}
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  markdown: {
    extendDefaultPlugins: false,
    smartypants: false,
    gfm: false,
  }
});
```

### Changed: MDX plugin configuration

#### Replaced: `extendPlugins` -> `extendMarkdownConfig`

In 1.0, `.mdx.extendPlugins` managed how your MDX files should inherit your Markdown plugin configuration. This setting was used to indicate whether all Markdown plugins (`markdown`), or only Astro's default plugins (`defaults`) should be applied to MDX.

Astro 2.0 replaces `mdx.extendPlugins` with three new, independently-configurable options:

- **[`mdx.extendMarkdownConfig`](/en/guides/integrations-guide/mdx/#extendmarkdownconfig)** (`true` by default) to inherit all of your Markdown configuration or none of it.
- **`mdx.gfm`** (`true` by default) to enable or disable GitHub-Flavored Markdown in MDX.
- **`mdx.smartypants`** (`true` by default) to enable or disable SmartyPants in MDX.

 ##### What should I do?

MDX options will default to their equivalent in your Markdown config. You no longer need `extendPlugins: 'markdown'` in your configuration for this behavior.

```js del={6}
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  mdx: {
    extendPlugins: markdown,
  }
});
```

If your MDX is currently configured to inherit only Astro's default plugins, replace `extendPlugins: 'defaults'` with `extendMarkdownConfig: false` to disable all inheritance. Use the [separate options for GitHub-Flavored Markdown and SmartyPants](/en/guides/integrations-guide/mdx/#options-inherited-from-markdown-config) to enable these default plugins individually in MDX.

```js del={6} ins={7-9}
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  mdx: {
    extendPlugins: defaults,
    extendMarkdownConfig: false,
    smartypants: true,
    gfm: true,
  }
});
```

#### Added: More MDX config options to match Markdown

Setting `extendMarkdownConfig` to false now allows you to individually set [every available Markdown configuration option](/en/reference/configuration-reference/#markdown-options) (except `drafts`) separately in your MDX integration config, including `syntaxHighlight`, `shikiConfig` and more.

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import mdx from '@astrojs/mdx';

export default defineConfig({
  markdown: {
    syntaxHighlight: 'prism',
    remarkPlugins: [remarkPlugin1],
    gfm: true,
  },
  integrations: [
    mdx({
      // `syntaxHighlight` inherited from Markdown

      // Markdown `remarkPlugins` ignored,
      // only `remarkPlugin2` applied.
      remarkPlugins: [remarkPlugin2],
      // `gfm` overridden to `false`
      gfm: false,
    })
  ]
});
```

##### What should I do?

Revisit your Markdown and MDX configuration and compare your existing config with the new options available.

:::tip[remember]
- Astro's two default Markdown plugins are now individually configurable, and are not removed when you add other plugins. No more extending defaults!
- The option to extend your Markdown plugin config to MDX has moved from a selection (just defaults or all plugins) to toggle (all or none).
- Every Markdown config option (except drafts) can also be configured independently in MDX!
:::

### Added: Plugin access to frontmatter

In 1.0, remark and rehype plugins did not have access to user frontmatter. Astro merged plugin frontmatter with your file's frontmatter, without passing the file frontmatter to your plugins.

Astro 2.0 gives remark and rehype plugins access to user frontmatter via frontmatter injection. This allows plugin authors to modify a user's existing frontmatter, or compute new properties based on other properties.


#### What should I do?

If you have written remark or rehype plugins for Astro, note that `data.astro.frontmatter` is now the _complete_ Markdown or MDX document's frontmatter, rather than an empty object. You may need to update your plugin accordingly.
 
With access to a file's frontmatter, you can now write plugins that use this data! For example, to compute a full image URL based on an `imageSrc` slug in your document frontmatter:

  ```ts
  export function remarkInjectSocialImagePlugin() {
    return function (tree, file) {
      const { frontmatter } = file.data.astro;
      frontmatter.socialImageSrc = new URL(frontmatter.imageSrc, 'https://my-blog.com/').pathname;
    };
  }
  ```

### Reserved: `src/content/`

In 1.0, the [Collections API was hidden behind an experimental flag](#content-collections). This API reserves `src/content/` as a special folder.

Astro 2.0 now includes the Collections API in the core codebase for organizing your Markdown and MDX files into [content collections](/en/guides/content-collections/).

#### What should I do?

If you have an existing `src/content/` folder, it must be renamed to avoid conflicts. This folder, if it exists, can now only be used for [content collections](/en/guides/content-collections/).

## Astro 2.0 Experimental Flags Removed

Astro v2.0 brings some exciting new features from previous experimental flags into the core codebase!

You can remove the following experimental flags from `astro.config.mjs`:

```js del={5-7}
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: { contentCollections: true },
  experimental: { prerender: true },
  experimental: { error-overlay: true },
})
```
The following features are no longer hidden behind an experimental flag and are all enabled by default.

#### What should I do?

While these do not require a change to your codebase, you may now wish to enjoy:
- [Content collections](#content-collections) as a way to manage your Markdown and MDX files with type-safety.
- [Prerendering individual pages to static HTML](#prerendering) when using SSR to improve speed and cacheability.
- [Error Overlay](#error-overlay) improvements: a complete redesign to help you better understand and fix your errors.



### Content Collections

The experimental flag `--experimental-contentCollections` has been removed. The Collections API is now available by default in Astro.

In 1.0, you could choose to keep your Markdown and MDX pages within `src/pages/` for automatic file-based routing. Or, you could choose another folder within `src/` and import your Markdown content into `.astro` page files.

Astro 2.0 adds a new way to manage your Markdown and MDX files in Astro, and a special `src/content/` folder. [Content collections](/en/guides/content-collections/) will organize your content, validate your frontmatter, and provide automatic TypeScript type-safety of fetched content. 

<FileTree>
- src/content/
  - **newsletter/** 
    - week-1.md
    - week-2.md
    - week-3.md
  - **authors/**
    - grace-hopper.md
    - alan-turing.md
    - batman.md
</FileTree>


Available in both SSG and SSR mode, collections can optionally include schemas to enforce consistent frontmatter within each collection and provide helpful autocompletion. Code with confidence, knowing the shape of your data as you reference it inside a page or component template.

```ts
// src/content/config.ts
import { z, defineCollection } from 'astro:content';

const blogSchema = defineCollection({
  schema: z.object({
    title: z.string(),
    tags: z.array(z.string()),
    image: z.string().optional(),
  }),
});

export const collections = {
  'blog': blogSchema,
};
```

See more about using [content collections in Astro](/en/guides/content-collections/).

### Prerendering

The experimental flag `--experimental-prerender` has been removed. [The `prerender` feature](/en/guides/server-side-rendering/#prerendering) is now enabled by default when using [`output:'server'`](/en/reference/configuration-reference/#output). 

In 1.0, one of the most requested features was to enable route-level control of output so that some routes can be server-rendered while others are statically-generated.

Astro 2.0 enables per route, opt-in prerendering when using `output: 'server'` (SSR mode).

Add `export const prerender = true` to any file in `src/pages/` that should be rendered at build time rather than request time.

```astro title="src/pages/index.astro" {3}
---
// This route should be generated at build time!
export const prerender = true;

const text = await fetch('https://example.com/').then(res => res.text())
---

<Fragment set:html={text} />
```
See more about using [SSR mode in Astro](/en/guides/server-side-rendering/).

### Error overlay

The experimental flag `--experimental-error-overlay` has been removed.

We hope you don't encounter too many errors when you build with Astro!

But when you do, we hope that our new error overlay gives you more helpful, easy-to-read information. You can now expect:

- A concise, descriptive error message identifying the problem.
- A hint with more information, including tips for finding or resolving the issue.
- A link to the error's page in docs. (There's one for every known Astro error!)
- A full, syntax-colored code window showing the location of the error.
- Support for dark and light mode.
- Houston in the corner!

<img src="https://user-images.githubusercontent.com/3019731/204646476-f6b27533-539e-4dfd-8f73-453a9159573e.png" alt="Screenshot of a color-coded and human-readable error message showing exactly where in your code an error occurred, with helpful tips for resoving the issue."/>


## Known Issues


